# -*- coding: utf-8 -*-
"""promotion_dashboard.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1gS8ErtzyrfIFxUHAYSRUfcTmYD_CZJUv
"""

from google.colab import files
uploaded = files.upload()

import streamlit as st
import pandas as pd
import plotly.express as px

# Load data
df = pd.read_csv("Promotion_Predictions_Updated.csv")

st.set_page_config(page_title="Promotion Prediction Dashboard",
                   layout="wide",
                   page_icon="ðŸ“Š")

st.title("ðŸ“Š Employee Promotion Prediction Dashboard")

# ---------------- Sidebar Filters ---------------- #
st.sidebar.header("ðŸ” Filter Employees")

gender_filter = st.sidebar.multiselect("Gender", options=df["Gender"].unique(), default=df["Gender"].unique())
department_filter = st.sidebar.multiselect("Department", options=df["Department"].unique(), default=df["Department"].unique())
age_filter = st.sidebar.slider("Age Range", int(df["Age"].min()), int(df["Age"].max()), (int(df["Age"].min()), int(df["Age"].max())))
empid_filter = st.sidebar.selectbox("Employee ID (optional filter)", ["All"] + list(df["EmployeeID"].unique()))

# Apply filters
filtered = df[
    (df["Gender"].isin(gender_filter)) &
    (df["Department"].isin(department_filter)) &
    (df["Age"] >= age_filter[0]) &
    (df["Age"] <= age_filter[1])
]

if empid_filter != "All":
    filtered = filtered[filtered["EmployeeID"] == empid_filter]

# ---------------- KPI Cards ---------------- #
total_employees = len(filtered)
promoted = filtered["Promotion_Predicted"].sum()
not_promoted = total_employees - promoted
promotion_rate = round((promoted / total_employees) * 100, 2) if total_employees > 0 else 0

kpi1, kpi2, kpi3, kpi4 = st.columns(4)
kpi1.metric("Total Employees", total_employees)
kpi2.metric("Promoted Employees", promoted)
kpi3.metric("Not Promoted Employees", not_promoted)
kpi4.metric("Promotion Rate (%)", promotion_rate)

st.markdown("---")

# ---------------- Visual 1: Count by Department ---------------- #
fig1 = px.histogram(filtered, x="Department", color="Promotion_Predicted", barmode="group",
                    title="Promotion Count by Department")
st.plotly_chart(fig1, use_container_width=True)

# ---------------- Visual 2: Promotions by Gender ---------------- #
fig2 = px.pie(filtered, names="Gender", values="Promotion_Predicted", title="Gender-wise Promotion Distribution")
st.plotly_chart(fig2, use_container_width=True)

# ---------------- Visual 3: Age vs Promotion ---------------- #
fig3 = px.box(filtered, x="Promotion_Predicted", y="Age", title="Age Distribution by Promotion Status",
              color="Promotion_Predicted")
st.plotly_chart(fig3, use_container_width=True)

# ---------------- Visual 4: Experience vs Performance ---------------- #
fig4 = px.scatter(filtered, x="Experience_Years", y="PerformanceScore",
                  color="Promotion_Predicted", size=filtered["Experience_Years"].abs(),
                  title="Experience vs Performance (Promotion Indicator)")
st.plotly_chart(fig4, use_container_width=True)

# ---------------- Visual 5: Average Performance Score by Department ---------------- #
fig5 = px.bar(filtered.groupby("Department")["PerformanceScore"].mean().reset_index(),
              x="Department", y="PerformanceScore",
              title="Average Performance Score by Department")
st.plotly_chart(fig5, use_container_width=True)

# ---------------- Visual 6: Heatmap â€” Promotion by Age Group & Department ---------------- #
heatmap_data = filtered.pivot_table(values="Promotion_Predicted", index="Age_Category", columns="Department", aggfunc="sum")
fig6 = px.imshow(heatmap_data, text_auto=True, title="Promotion Heatmap by Age Category and Department")
st.plotly_chart(fig6, use_container_width=True)

st.markdown("---")

# ---------------- Display Data ---------------- #
st.subheader("ðŸ“„ Filtered Employee Data")
st.dataframe(filtered)

# ---------------- Download Button ---------------- #
csv = filtered.to_csv(index=False).encode("utf-8")
st.download_button("â¬‡ Download Filtered Dataset", data=csv, file_name="Filtered_Promotion_Data.csv", mime="text/csv")

