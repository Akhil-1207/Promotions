# -*- coding: utf-8 -*-
"""promotion_dashboard.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1gS8ErtzyrfIFxUHAYSRUfcTmYD_CZJUv
"""

# ------------------------------------------------------------
# üéØ HR Promotions Dashboard (Works only with Final_Promotions_Predicted_Dataset.csv)
# ------------------------------------------------------------

import streamlit as st
import pandas as pd
import plotly.express as px
import os

st.set_page_config(page_title="HR Promotions Dashboard", layout="wide")
st.title("üìä HR Promotions Analytics Dashboard")

# ---------------------------------------------------------------
# Load dataset
# ---------------------------------------------------------------
@st.cache_data
def load_data():
    file_name = "Final_Promotions_Predicted_Dataset.csv"
    if not os.path.exists(file_name):
        st.error(f"‚ùå File '{file_name}' not found. Place the CSV in the same folder as dashboard.py")
        st.stop()
    return pd.read_csv(file_name)

df = load_data()

# Ensure readability (convert 0/1 to Yes/No if needed)
df["Prediction"] = df["Prediction"].replace({1: "Yes", 0: "No"})

# ---------------------------------------------------------------
# Sidebar Filters
# ---------------------------------------------------------------
st.sidebar.header("üîç Filters")
filtered = df.copy()

if "Department" in df.columns:
    d_filter = st.sidebar.multiselect("Filter by Department", df["Department"].unique())
    if d_filter:
        filtered = filtered[filtered["Department"].isin(d_filter)]

if "Gender" in df.columns:
    g_filter = st.sidebar.multiselect("Filter by Gender", df["Gender"].unique())
    if g_filter:
        filtered = filtered[filtered["Gender"].isin(g_filter)]

# ---------------------------------------------------------------
# KPI Metrics (Prediction = Final Promotion Result)
# ---------------------------------------------------------------
total = len(filtered)
promoted = filtered["Prediction"].eq("Yes").sum()

col1, col2, col3 = st.columns(3)
col1.metric("Total Employees", total)
col2.metric("Employees Promoted", promoted)
col3.metric("Promotion %", f"{(promoted / total * 100):.2f}%")

st.markdown("---")

# ---------------------------------------------------------------
# Visuals
# ---------------------------------------------------------------

if "Department" in df.columns:
    st.subheader("üìå Promotion Count by Department")
    st.plotly_chart(px.histogram(
        filtered, x="Department", color="Prediction", barmode="group",
        title="Promotion Distribution by Department"
    ), use_container_width=True)

if "Gender" in df.columns:
    st.subheader("üìå Promotion Count by Gender")
    st.plotly_chart(px.histogram(
        filtered, x="Gender", color="Prediction", barmode="group",
        title="Promotion Distribution by Gender"
    ), use_container_width=True)

# Promotion Probability Heatmap (only if column exists)
prob_col = next((c for c in df.columns if "prob" in c.lower()), None)
if prob_col and "Satisfaction" in df.columns and "PerformanceScore" in df.columns:
    st.subheader("üìå Promotion Probability Heatmap")
    st.plotly_chart(px.density_heatmap(
        filtered, x="Satisfaction", y="PerformanceScore", z=prob_col,
        title="Probability Distribution"
    ), use_container_width=True)

# ---------------------------------------------------------------
# Table + download
# ---------------------------------------------------------------
st.markdown("---")
st.subheader("üìã Dataset Preview")
st.dataframe(filtered, use_container_width=True)

csv = filtered.to_csv(index=False).encode("utf-8")
st.download_button(
    "‚¨á Download Filtered Dataset",
    data=csv,
    file_name="Filtered_Promotions.csv",
    mime="text/csv"
)


