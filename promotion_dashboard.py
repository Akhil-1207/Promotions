# -*- coding: utf-8 -*-
"""promotion_dashboard.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1gS8ErtzyrfIFxUHAYSRUfcTmYD_CZJUv
"""

# ------------------------------------------------------------
# ğŸ“Œ HR Promotions Analytics Dashboard
# ------------------------------------------------------------
import streamlit as st
import pandas as pd
import plotly.express as px

# ------------------------------------------------------------
# Page Setup
# ------------------------------------------------------------
st.set_page_config(page_title="HR Promotions Dashboard", layout="wide")
st.title("ğŸ¯ HR Promotions Analytics Dashboard")

# ------------------------------------------------------------
# Load Dataset
# ------------------------------------------------------------
@st.cache_data
def load_data():
    return pd.read_csv("Promotion_Predictions_Updated.csv") # Changed to use Promotion_Predictions_Updated.csv

df = load_data()

# Convert Promotion_Predicted column to readable labels if it exists
if "Promotion_Predicted" in df.columns:
    df["Promotion_Predicted"] = df["Promotion_Predicted"].map({1: "Yes", 0: "No"})

# ------------------------------------------------------------
# Filters Panel
# ------------------------------------------------------------
st.sidebar.header("ğŸ” Filter Data")
departments = st.sidebar.multiselect("Select Department", df["Department"].unique())
genders = st.sidebar.multiselect("Select Gender", df["Gender"].unique())

filtered_df = df.copy()
if departments:
    filtered_df = filtered_df[filtered_df["Department"].isin(departments)]
if genders:
    filtered_df = filtered_df[filtered_df["Gender"].isin(genders)]

# ------------------------------------------------------------
# KPI Metrics
# ------------------------------------------------------------
col1, col2, col3, col4 = st.columns(4)

col1.metric("Total Employees", len(filtered_df))
# Using 'Promotion_Predicted' for both actual and predicted due to data availability
col2.metric("Promotion %", f"{(filtered_df['Promotion_Predicted'].eq('Yes').mean() * 100):.2f}%")
col3.metric("Predicted Promotion %", f"{(filtered_df['Promotion_Predicted'].eq('Yes').mean() * 100):.2f}%")
col4.metric("Mismatch Records", sum(filtered_df["Promotion_Predicted"] != filtered_df["Promotion_Predicted"])) # Will be 0

st.markdown("---")

# ------------------------------------------------------------
# ğŸ”¥ 6 Visuals for Insights
# ------------------------------------------------------------

# 1 â€” Employee Count by Department
st.subheader("ğŸ“Š Visual 1 â€” Employee Count by Department")
st.plotly_chart(px.bar(filtered_df, x="Department", title="Employee Count by Department"), use_container_width=True)

# 2 â€” Gender Distribution by Department
st.subheader("ğŸ“Š Visual 2 â€” Gender Distribution by Department")
st.plotly_chart(
    px.histogram(filtered_df, x="Department", color="Gender", barmode="group", title="Gender Breakdown per Department"),
    use_container_width=True,
)

# 3 â€” Promotion Rate by Department
st.subheader("ğŸ“Š Visual 3 â€” Promotion Rate by Department")
st.plotly_chart(
    px.histogram(filtered_df, x="Department", color="Promotion_Predicted", barmode="group",
                 title="Promotion Distribution by Department"),
    use_container_width=True,
)

# 4 â€” Another view of Promotion Rate by Department
st.subheader("ğŸ“Š Visual 4 â€” Another Promotion Rate by Department")
st.plotly_chart(
    px.histogram(filtered_df, x="Department", color="Promotion_Predicted", barmode="group",
                 title="Promotion Distribution by Department (Another View)"),
    use_container_width=True,
)

# 5 â€” Heatmap for Promotion Probability (if column exists)
if "Promotion_Probability" in df.columns:
    st.subheader("ğŸ“Š Visual 5 â€” Heatmap of Promotion Probability")
    st.plotly_chart(
        px.density_heatmap(
            filtered_df,
            x="Satisfaction",
            y="PerformanceScore",
            z="Promotion_Probability",
            title="Promotion Probability Heatmap"
        ),
        use_container_width=True,
    )

# 6 â€” Promotion % by Department
st.subheader("ğŸ“Š Visual 6 â€” Promotion % by Department")
df_compare = filtered_df.groupby("Department")["Promotion_Predicted"].apply(
    lambda x: pd.Series({
        "Promotion%": (x.eq("Yes").mean()) * 100
    })
).reset_index()

st.plotly_chart(
    px.bar(df_compare, x="Department", y="Promotion_Predicted",
           title="Promotion % Comparison"),
    use_container_width=True,
)

st.markdown("---")

# ------------------------------------------------------------
# Table + Download Option
# ------------------------------------------------------------
st.subheader("ğŸ“‹ Dataset Preview With Predictions")
st.dataframe(filtered_df, use_container_width=True)

csv = filtered_df.to_csv(index=False).encode("utf-8")
st.download_button(
    "â¬‡ Download Filtered Dataset",
    data=csv,
    file_name="Filtered_Promotions_Dataset.csv",
    mime="text/csv"
)
